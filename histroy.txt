Server:

sudo sysctl -w net.ipv4.ip_forward=1
sudo iptables -A FORWARD -i usb1 -o enp0s31f6 -j ACCEPT
curl -sfL https://get.k3s.io | sh -

sudo iptables -A FORWARD -p udp --dport 53 -j ACCEPT
sudo iptables -A FORWARD -p tcp --dport 53 -j ACCEPT
echo "nameserver 8.8.8.8" | sudo tee /etc/resolv.conf
sudo apt-get install -y chrony
sudo vim /etc/chrony/chrony.conf 
sudo systemctl restart chrony
sudo systemctl enable chrony

sudo cat /var/lib/rancher/k3s/server/node-token

sudo k3s kubectl apply -f pod.yaml 
sudo k3s kubectl get pods -o wide
sudo k3s kubectl describe pods web-server -o wide

sudo ctr -n k8s.io images pull --platform linux/arm/v7 docker.io/harrisonchen0418/go_build:BBB
sudo ctr -n k8s.io images export --platform linux/arm/v7 go_build_BBB.tar docker.io/harrisonchen0418/go_build:BBB
scp go_build_BBB.tar debian@192.168.7.2:/tmp/

sudo ctr -n k8s.io images pull --platform linux/arm/v7 docker.io/rancher/mirrored-pause:3.6
sudo ctr -n k8s.io images pull --platform linux/arm/v7 docker.io/rancher/mirrored-coredns-coredns:1.10.1
sudo ctr -n k8s.io images export --platform linux/arm/v7 /tmp/k3s-armv7-base.tar docker.io/rancher/mirrored-pause:3.6 docker.io/rancher/mirrored-coredns-coredns:1.10.1

Beagle Bone Black

echo "nameserver 8.8.8.8" | sudo tee /etc/resolv.conf
echo "nameserver 8.8.4.4" | sudo tee -a /etc/resolv.conf
ping -c 4 www.google.com
sudo timedatectl set-ntp true
sudo timedatectl status
sudo apt-get install -y chron
sudo apt-get install -y chrony

sudo timedatectl status
sudo systemctl restart systemd-timesyncd
sudo vim /etc/systemd/timesyncd.conf
sudo systemctl restart systemd-timesyncd
sudo systemctl unmask systemd-timesyncd
sudo systemctl enable systemd-timesyncd
vim chrony/chrony.conf 
sudo vim chrony/chrony.conf 
sudo systemctl restart chrony
sudo systemctl enable chrony
chronyc sources -v
date
sudo apt-get update
ping 172.30.60.103
curl https://172.30.60.103:6443
export SERVER_IP=172.30.60.103

export K3S_TOKEN=K10c9cd4f304c4fd4a9de31c2d433d2c975858012a28e721cbbd23e114b8219da56::server:e5ba17af28d2bf9d42c9bb76f8be8fb2
curl -sfL https://get.k3s.io | K3S_URL=https://$SERVER_IP:6443 K3S_TOKEN=$K3S_TOKEN sh -
vim pod.yaml
echo "nameserver 172.16.0.99" | sudo tee /etc/resolv.conf
echo "nameserver 172.16.0.100" | sudo tee -a /etc/resolv.conf
ping www.google.com

sudo ctr -n k8s.io images import /tmp/go_build_BBB.tar 
sudo ctr -n k8s.io images list
sudo ctr -n k8s.io images list | grep harrisonchen0418
sudo ctr -n k8s.io images pull docker.io/rancher/mirrored-pause:3.6
sudo ctr -n k8s.io images import /tmp/k3s-armv7-base.tar 
sudo ctr -n k8s.io images list


sudo apt-get update
sudo apt-get install -y chrony
編輯 /etc/chrony/chrony.conf
pool 192.168.7.1 iburst
sudo systemctl restart chrony
sudo systemctl enable chrony

在 host 跑 chrony 當 NTP server，BBB 也用 chrony 當 client，最乾淨。


